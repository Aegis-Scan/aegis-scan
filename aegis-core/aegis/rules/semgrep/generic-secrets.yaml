rules:
  # ── AWS Keys ──
  - id: secret-aws-access-key
    pattern-regex: '(?:^|[^A-Za-z0-9])AKIA[0-9A-Z]{16}(?:[^A-Za-z0-9]|$)'
    message: >
      AWS Access Key ID detected. Remove and rotate immediately.
      Use IAM roles or environment variables instead.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      owasp: ["A07:2021"]
      aegis_capability: "secret:access"

  - id: secret-aws-secret-key
    pattern-regex: '(?:aws_secret|secret_access_key|AWS_SECRET)\s*[:=]\s*["\x27]?[A-Za-z0-9/+=]{40}["\x27]?'
    message: >
      AWS Secret Access Key detected. Rotate immediately.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  # ── GitHub ──
  - id: secret-github-pat
    pattern-regex: 'ghp_[A-Za-z0-9]{36}'
    message: >
      GitHub Personal Access Token detected. Revoke and regenerate.
      Use GitHub Apps or fine-grained PATs with minimal scope.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  - id: secret-github-oauth
    pattern-regex: 'gho_[A-Za-z0-9]{36}'
    message: >
      GitHub OAuth token detected. Revoke and regenerate.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  - id: secret-github-app
    pattern-regex: '(ghu|ghs)_[A-Za-z0-9]{36}'
    message: >
      GitHub App token detected.
    severity: WARNING
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]

  # ── Stripe ──
  - id: secret-stripe-live-key
    pattern-regex: 'sk_live_[A-Za-z0-9]{24,}'
    message: >
      Stripe live secret key detected. This grants full access to your Stripe account.
      Remove immediately and rotate the key.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  - id: secret-stripe-restricted-key
    pattern-regex: 'rk_live_[A-Za-z0-9]{24,}'
    message: >
      Stripe restricted API key detected. Remove and rotate.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]

  # ── Slack ──
  - id: secret-slack-token
    pattern-regex: 'xox[bpors]-[A-Za-z0-9\-]{10,}'
    message: >
      Slack token detected. Revoke and regenerate in Slack admin.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  - id: secret-slack-webhook
    pattern-regex: 'hooks\.slack\.com/services/T[A-Z0-9]{8}/B[A-Z0-9]{8}/[A-Za-z0-9]{24}'
    message: >
      Slack Incoming Webhook URL detected.
    severity: WARNING
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]

  # ── Google Cloud ──
  - id: secret-google-api-key
    pattern-regex: 'AIza[0-9A-Za-z_\-]{35}'
    message: >
      Google API key detected. Restrict key permissions and use environment variables.
    severity: WARNING
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  # ── Private Keys ──
  - id: secret-private-key-rsa
    pattern-regex: '-----BEGIN RSA PRIVATE KEY-----'
    message: >
      RSA private key detected in source code. Remove immediately and
      store in a secure key management system.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-321"]
      aegis_capability: "secret:access"

  - id: secret-private-key-generic
    pattern-regex: '-----BEGIN (EC |DSA |OPENSSH )?PRIVATE KEY-----'
    message: >
      Private key detected in source code. Remove and use a key vault.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-321"]
      aegis_capability: "secret:access"

  # ── JWT Tokens ──
  - id: secret-jwt-token
    pattern-regex: 'eyJ[A-Za-z0-9_-]{10,}\.eyJ[A-Za-z0-9_-]{10,}\.[A-Za-z0-9_-]{10,}'
    message: >
      JWT token detected in source code. Remove and use secure token storage.
    severity: WARNING
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]

  # ── Generic High-Entropy Secrets ──
  - id: secret-generic-password-assign
    pattern-regex: '(?:PASSWORD|PASSWD|DB_PASS|MYSQL_ROOT_PASSWORD|POSTGRES_PASSWORD)\s*[:=]\s*["\x27][^"\x27]{8,}["\x27]'
    message: >
      Hardcoded password in variable assignment. Use environment variables.
    severity: WARNING
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  - id: secret-generic-token-assign
    pattern-regex: '(?:TOKEN|AUTH_TOKEN|ACCESS_TOKEN|BEARER)\s*[:=]\s*["\x27][A-Za-z0-9_\-]{20,}["\x27]'
    message: >
      Hardcoded token detected. Use environment variables or a secrets manager.
    severity: WARNING
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  # ── SendGrid ──
  - id: secret-sendgrid-api-key
    pattern-regex: 'SG\.[A-Za-z0-9_\-]{22}\.[A-Za-z0-9_\-]{43}'
    message: >
      SendGrid API key detected. Rotate immediately.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  # ── Twilio ──
  - id: secret-twilio-api-key
    pattern-regex: 'SK[a-f0-9]{32}'
    message: >
      Possible Twilio API key detected.
    severity: WARNING
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]

  # ── Mailgun ──
  - id: secret-mailgun-api-key
    pattern-regex: 'key-[A-Za-z0-9]{32}'
    message: >
      Possible Mailgun API key detected.
    severity: WARNING
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]

  # ── Heroku ──
  - id: secret-heroku-api-key
    pattern-regex: '[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}'
    message: >
      Possible UUID/API key detected (matches Heroku API key pattern).
    severity: INFO
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]

  # ── Azure ──
  - id: secret-azure-storage-connection-string
    pattern-regex: 'DefaultEndpointsProtocol=https?;AccountName=[^;]+;AccountKey=[A-Za-z0-9+/=]{40,}'
    message: >
      Azure Storage connection string with AccountKey detected. Store in
      Azure Key Vault or environment variables. Rotate the key immediately.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  - id: secret-azure-sql-connection-string
    pattern-regex: 'Server=.*\.database\.windows\.net.*Password=[^;]+'
    message: >
      Azure SQL connection string with password detected. Use managed
      identity or store credentials in Azure Key Vault.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  # ── Datadog ──
  - id: secret-datadog-api-key
    pattern-regex: '(?:DD_API_KEY|DATADOG_API_KEY|dd_api_key|datadog_api_key)\s*[:=]\s*["\x27]?[a-f0-9]{32}["\x27]?'
    message: >
      Datadog API key detected. Use environment variables or a secrets manager.
    severity: WARNING
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  - id: secret-datadog-app-key
    pattern-regex: '(?:DD_APP_KEY|DATADOG_APP_KEY|dd_app_key)\s*[:=]\s*["\x27]?[a-f0-9]{40}["\x27]?'
    message: >
      Datadog Application key detected. Use environment variables or a secrets manager.
    severity: WARNING
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]

  # ── npm ──
  - id: secret-npm-token
    pattern-regex: 'npm_[A-Za-z0-9]{36}'
    message: >
      npm access token detected. Revoke and regenerate in npm settings.
      Never commit npm tokens to source control.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  # ── DigitalOcean ──
  - id: secret-digitalocean-token
    pattern-regex: 'dop_v1_[a-f0-9]{64}'
    message: >
      DigitalOcean personal access token detected. Revoke and regenerate.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"

  - id: secret-digitalocean-oauth
    pattern-regex: 'doo_v1_[a-f0-9]{64}'
    message: >
      DigitalOcean OAuth token detected. Revoke and regenerate.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]

  # ── Cloudflare ──
  - id: secret-cloudflare-api-token
    pattern-regex: 'CloudFlare|(?:CF_API_TOKEN|CLOUDFLARE_API_TOKEN)\s*[:=]\s*["\x27]?[A-Za-z0-9_\-]{40}["\x27]?'
    message: >
      Possible Cloudflare API token detected. Use environment variables.
    severity: WARNING
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]

  # ── PyPI ──
  - id: secret-pypi-token
    pattern-regex: 'pypi-[A-Za-z0-9_\-]{20,}'
    message: >
      PyPI API token detected. Revoke in PyPI account settings and regenerate.
    severity: ERROR
    languages: [generic]
    metadata:
      cwe: ["CWE-798"]
      aegis_capability: "secret:access"
